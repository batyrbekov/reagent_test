{"version":3,"sources":["ajax/transit.cljc"],"mappings":";;;;;;AAQA,AAAA,AAAAA,AAAMM;AAAN,AAAA,AAAAL,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAA4BM;AAA5B,AACE,AAAAC,AAAID;AAAJ,AAAA,AAAAC;AAAAA;;AAAA;;;AAEQ,AAAA,AAAMC,AACHF,AAAKG;AADR,AAEE,AAAMC,AAAO,AAAAH,AAAI,AAAA,AAASE;AAAb,AAAA,AAAAF;AAAAA;;AACI,AAACI,AAASL,AAAKG;;;AADhC,AAEE;AAA0BG;AAA1B,AACE,AAACC,AAAQH,AAAOE;;;;AAMhC,AAAA,AAAA,AAAAE,AAAME;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMD;AAAN,AACM,AAAA,AAACE;;;AADP,AAAA,AAAA,AAAMF,AAEFP;AAFJ,AAGK,AAAMH,AAAK,AAACD,AAAaI;AACnBU,AAAU,AAAA,AAAA,AAAI,AAAA,AAACC,AAAEd;AADvB,AAAA,AAAA,AAAA,AAEU,AAACE,AAAiBF,AAAKG,AAChB,AAAA,AAA4BU;;;AANlD,AAAA,AAAA,AAAMH;;AAAN,AAQU,AAAA,AAAMK,AAAiBZ;AAAvB,AACE,AAAMa,AAAO,AAAAf,AAAI,AAAA,AAASE;AAAb,AAAA,AAAAF;AAAAA;;AACI,AAAA,AAACgB,AAAed;;;AADjC,AAEE;AAA2Be;AAA3B,AACE,AAACC,AAAOH,AAAO,AAACI,AAASF;;;;AASzC,AAAA,AAAA,AAAAV,AAAMc;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAX,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMW;AAAN,AACM,AAAA,AAACC;;;AADP,AAAA,AAAA,AAAMD,AAEFnB;AAFJ,AAGK,AAACqB,AAAwB,AAACzB,AAAaI,AAASA;;;AAHrD,AAAA,AAAA,AAAMmB,AAIFtB,AAAKG;AAJT,AAKK,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACsB,AACO,AAACV,AAAgBZ;;;AAN9B,AAAA,AAAA,AAAMmB;;AAAN","names":["p__26458","map__26459","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","ajax.transit/transit-type","type","or__4131__auto__","ajax.transit/transit-write-fn","request","writer","cognitect.transit.writer.cljs$core$IFn$_invoke$arity$2","params","cognitect.transit/write","var_args","G__26464","ajax.transit/transit-request-format","js/Error","ajax.transit.transit_request_format.cljs$core$IFn$_invoke$arity$1","mime-type","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","ajax.transit/transit-read-fn","reader","cognitect.transit.reader.cljs$core$IFn$_invoke$arity$2","response","cognitect.transit/read","ajax.protocols/-body","G__26472","ajax.transit/transit-response-format","ajax.transit.transit_response_format.cljs$core$IFn$_invoke$arity$1","ajax.transit.transit_response_format.cljs$core$IFn$_invoke$arity$2","ajax.interceptors/map->ResponseFormat"],"sourcesContent":["(ns ajax.transit\n    (:require [cognitect.transit :as t]\n              [ajax.interceptors :as i]\n              [ajax.protocols :as pr]\n              [ajax.util :as u]\n              #? (:clj  [poppea :as p]))\n    #? (:cljs (:require-macros [poppea :as p])))\n\n(defn transit-type [{:keys [type]}]\n  (or type #? (:cljs :json :clj :msgpack)))\n\n#? (:cljs (defn transit-write-fn\n            [type request]\n            (let [writer (or (:writer request)\n                             (t/writer type request))]\n              (fn transit-write-params [params]\n                (t/write writer params))))\n    :clj (p/defn-curried transit-write-fn\n           [type request stream params]\n           (let [writer (t/writer stream type request)]\n             (t/write writer params))))\n\n(defn transit-request-format\n  ([] (transit-request-format {}))\n  ([request]\n     (let [type (transit-type request)\n           mime-type (if (= type :json) \"json\" \"msgpack\")]\n       {:write (transit-write-fn type request)\n        :content-type (str \"application/transit+\" mime-type)})))\n\n#? (:cljs (defn transit-read-fn [request]\n            (let [reader (or (:reader request)\n                             (t/reader :json request))]\n              (fn transit-read-response [response]\n                (t/read reader (pr/-body response)))))\n    :clj (p/defn-curried transit-read-fn [request response]\n           (let [content-type (u/get-content-type response)\n                 type (if (.contains content-type \"msgpack\")\n                        :msgpack :json)\n                 stream (pr/-body response)\n                 reader (t/reader stream type request)]\n             (t/read reader))))\n\n(defn transit-response-format\n  ([] (transit-response-format {}))\n  ([request]\n     (transit-response-format (transit-type request) request))\n  ([type request]\n     (i/map->ResponseFormat\n      {:read (transit-read-fn request)\n       :description \"Transit\"\n       :content-type\n       #? (:cljs [\"application/transit+json\"]\n           :clj [\"application/transit+msgpack\"\n                 \"application/transit+json\"])})))\n"]}